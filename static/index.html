<!DOCTYPE html>

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:opsz,wght@6..12,1000&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            font-family: 'Nunito Sans', sans-serif;
        }

        h1 {
            font-size: 4rem;
        }

        #kod h1 {
            font-size: 7rem;
        }

        .btn-green {
            background-color: limegreen;
        }

        .nodisplay {
            display: none;
        }
    </style>

    <script type="module">
        import { io } from "https://cdn.socket.io/4.7.4/socket.io.esm.min.js";

        const socket = io();

        var soba;

        $.get("/sobe/kreiraj/", function (kod) {
            $("#kod").html(`<h1>${kod}</h1>`);

            socket.on("soba_" + kod, function (data) {
                soba = JSON.parse(data)
                onChanged(soba)
            });
        });

        function onChanged(soba) {
            console.log(soba);
            if (soba.ucesnici.length != 0) {
                $("#nemaucesnika").addClass("nodisplay");
            } else {
                $("#nemaucesnika").removeClass("nodisplay");
            }

            $("#ucesnici").empty();
            soba.ucesnici.forEach(e => $("#ucesnici").append(`<p class="m-0"><img class="p-1" src="static/avatari/${e.avatar}.png" style="height:2rem">${e.ime}</p>`))
            
            if(soba.stanje == "countdown") {
                $("#ulaz").addClass("nodisplay");
                $("#countdownDiv").removeClass("nodisplay");

                $("#countdown").html(soba.countdown);
            }

            if(soba.stanje == "pitanje") {
                $("#ulaz").addClass("nodisplay");
                $("#countdownDiv").addClass("nodisplay");
                $("#pitanje").removeClass("nodisplay");

                $("#pitanje").html(soba.pitanje.pitanje);
            }

        }

        function zapocniSobu() {
            $.post("/sobe/zapocni/?kod=" + soba.kod);
        }


        $("#zapocniButton").on("click", function () {
            zapocniSobu();
        });

    </script>

</head>

<body class="bg-info">
    <div class="h-100 d-flex justify-content-center align-items-center text-white">
        <div id="ulaz">
            <h1>KÔD ZA SOBU:</h1>

            <div class="d-flex justify-content-center" id="kod">
                <div class="spinner-border align-items-center" role="status" style="width: 7rem; height: 7rem;"></div>
            </div>
            <div class="m-4">
                Učesnici:
                <div class="border border-light rounded   p-2" id="ucesnici">
                    <div class="text-muted" id="nemaucesnika">Nema učesnika</div>
                </div>
            </div>
            <div class="d-flex justify-content-center">
                <button class="btn btn-primary text-white p-3 display-5 rounded-pill"
                    id="zapocniButton">ZAPOČNI</button>
            </div>

        </div>
        <div id="countdownDiv" class="nodisplay">
            <h1 id="countdown"></h1>
        </div>

        <div id="pitanjeDiv" class="nodisplay">
            <h1 id="pitanje"></h1>
        </div>
    </div>



</body>

</html>